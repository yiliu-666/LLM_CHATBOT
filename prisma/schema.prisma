

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL") 

}

model Conversation {
  id        String    @id @default(cuid())
  title     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // 主会话里的消息
  messages  Message[]

  // ⭐ 额外加：指向“副会话”的外键（也是 Conversation 一条）
  lowConversationId String? @unique
  
  // 正向关系：通过 lowConversationId 导航到副会话
  lowConversation   Conversation?    @relation("LowConversation", fields: [lowConversationId], references: [id])

  // 反向关系：谁把我当成自己的 lowConversation
  parentConversation Conversation?   @relation("LowConversation")
}

model Message {
  id             String   @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])

  role           String
  content        Json
  createdAt      DateTime @default(now())
}